define(["jquery","common/template/urlBuilder","common/essentialData"],function($,urlBuilder,essentialData){var cartCount={cartLi:$(".icon-menus .cart"),init:function(){this.getCartCount();this.cartLi.on("mouseenter",$.proxy(function(e){this.getCartListAjax();$(e.currentTarget).addClass("cart-preview-hover")},this));this.cartLi.on("mouseleave",function(e){$(e.currentTarget).removeClass("cart-preview-hover")})},getCartCount:function(){$.ajax({url:urlBuilder.buildRequestUrl("/np/cartCount"),type:"GET",
dataType:"jsonp",jsonp:"callback",success:function(result){var cartCount=result.productCountInCart;$("#headerCartCount").html(cartCount);$(".cart-count").html(cartCount)},error:function(){$("#headerCartCount").html(0);$(".cart-count").html(0)}})},getCartListAjax:function(){var url=urlBuilder.buildRequestUrl("/np/cartListInfo");$.ajax({url:url,type:"GET",data:{cartApiCount:15,limit:4},xhrFields:{withCredentials:true}}).success($.proxy(function(response){this.renderCartList(response)},this))},renderCartList:function(response){var result;
try{result=JSON.parse(response)}catch(e){result={}}var documentFragment=$(document.createDocumentFragment());var html=this.makeCartPreviewHtml(result);documentFragment.append(html);$(".mycart-preview-products").html(documentFragment);if(!result||result.cartList&&result.cartList.length!==0)if($(".mycart-preview-products").next().size()===0)$(".mycart-preview-products").after(this.makeViewAllCartBtn());this.bindLogging()},makeCartPreviewHtml:function(data){var html="";var MAX_PRODUCT_NUM=4;if(!data||
!data.cartList||data.cartList.length===0)html+='\x3cli class\x3d"empty-cart"\x3e'+Pacifik.formatMessage("coupang.web.9a3b14","장바구니에 담긴 상품이 없습니다.")+"\x3c/li\x3e";else{var productCount=data.cartList.length<MAX_PRODUCT_NUM?data.cartList.length:MAX_PRODUCT_NUM;for(var i=0;i<productCount;i++){var cartDto=data.cartList[i];var domain="//www.coupang.com";var link=domain+cartDto.link;var image=cartDto.imageAndTitleArea.defaultUrl;var title=cartDto.imageAndTitleArea.title;html+='\x3cli class\x3d"preview-product"\x3e\x3ca href\x3d"'+
link+'"  data-log-props\x3d\'{ "id" : "cart_item_'+i+'" }\'\x3e\x3cimg src\x3d"'+image+'" width\x3d"70" height\x3d"70"/\x3e\x3cp class\x3d"mycart-preview-producttitle"\x3e\x3cspan\x3e\x3cspan\x3e'+title+"\x3c/span\x3e\x3c/span\x3e\x3c/p\x3e\x3c/a\x3e\x3c/li\x3e";if(cartDto.bundleOptionArea){var arrowImage=cartDto.bundleOptionArea.arrowImageUrl||"";var bundleOptionItems=cartDto.bundleOptionArea.bundleOptionItems||[];for(var j=0;j<bundleOptionItems.length;j++){var bundleOptionItem=bundleOptionItems[j].imageAndTitleArea||
null;if(bundleOptionItem===null)return;var bundleItemTitleIcon=bundleOptionItem.defaultUrl||"";var bundleOptionItemTitle=bundleOptionItem.title||"";html+='\x3cli class\x3d"preview-product bundle-option-item"\x3e\x3cimg src\x3d"'+arrowImage+'" class\x3d"arrow-icon"\x3e\x3cdiv class\x3d"bundle-item-info"\x3e\x3cstrong class\x3d"mycart-preview-bundle-item-title"\x3e\x3cimg src\x3d"'+bundleItemTitleIcon+'" class\x3d"bundle-item-title-icon"\x3e '+bundleOptionItemTitle+"\x3c/strong\x3e\x3c/div\x3e\x3c/li\x3e"}}}}return html},
makeViewAllCartBtn:function(){var html="";html='\x3ca href\x3d"//cart.coupang.com/cartView.pang" class\x3d"mycart-btn" data-log-props\x3d\'{ "id": "cart_all" }\'\x3e\x3cspan\x3e\x3cspan\x3e'+Pacifik.formatMessage("coupang.web.ca26ed","장바구니 전체보기")+'\x3c/span\x3e\x3ci class\x3d"blue-arrow"\x3e\x3c/i\x3e\x3c/span\x3e\x3c/a\x3e';return html},bindLogging:function(){coupangWebRequire(["common/gnbClickCoulogger"],function(GnbClickCoulogger){GnbClickCoulogger.init({wrapper:"header #mycart-preview",selector:"data-log-props"})});
if(essentialData.getAbTestOptionByKey("4250")==="B")coupangWebRequire(["common/gnbWebLogger"],function(GnbWebLogger){GnbWebLogger.init({wrapper:"header #mycart-preview",selector:"data-log-props"})})}};return cartCount});