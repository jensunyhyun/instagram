define(["jquery","common/template/search/speech/textarea-helper"],function($){var speechRecognizer=function(){if(this.$init)this.$init.apply(this,arguments)};speechRecognizer.prototype={constructor:speechRecognizer,$init:function(htOption){if(this.isChrome()){this._welMicButton;this._welTextArea=$(htOption.textarea);this._sTextAreaID=htOption.textareaID;this._bStarted=false;this.addSpeechRecognitionButton(htOption.insertTarget);this.initSpeechRecognition();this._attachEvent()}},addSpeechRecognitionButton:function(insertTarget){this._welTextArea.addClass("is-speech");
$(insertTarget).append('\x3ca href\x3d"#" class\x3d"speech-content-mic speech-mic" data-gaclick\x3d"{"hitType":"event", "eventCategory":"GNB", "eventAction":"click", "eventLabel":"STT", "eventValue":0}"\x3e'+Pacifik.formatMessage("coupang.web.990d4f","마이크")+"\x3c/a\x3e");this._welMicButton=$(".speech-content-mic")},initSpeechRecognition:function(){try{this._oRecognition=new webkitSpeechRecognition}catch(e){this._oRecognition=Object}this._oRecognition.continuous=true;this._oRecognition.interimResults=
true;this._sInterimResult=""},isChrome:function(){if(navigator.userAgent.toLowerCase().match("chrome"))return true;return false},_onRecognitionResult:function(e){var pos=this._welTextArea.getCursorPosition()-this._sInterimResult.length;this._welTextArea.val(this._welTextArea.val().replace(this._sInterimResult,""));this._sInterimResult="";this._welTextArea.setCursorPosition(pos);for(var i=e.resultIndex;i<e.results.length;++i)if(e.results[i].isFinal)insertAtCaret(this._sTextAreaID,e.results[i][0].transcript);
else{insertAtCaret(this._sTextAreaID,e.results[i][0].transcript+"​");this._sInterimResult+=e.results[i][0].transcript+"​"}},_onRecognitionEnd:function(){this._welMicButton.removeClass("speech-mic-works").addClass("speech-mic");this._bStarted=false;return false},_onStartRecognitionClick:function(){if(!this._bStarted){this._welMicButton.removeClass("speech-mic").addClass("speech-mic-works");this._welTextArea.focus();this._oRecognition.start();this._bStarted=true;$(".speech-mic-works").bind("click",
$.proxy(this._onStopRecognitionClick,this))}return false},_onStopRecognitionClick:function(){this._oRecognition.stop();return false},_attachEvent:function(){this._welMicButton.bind("click",$.proxy(this._onStartRecognitionClick,this));this._oRecognition.onresult=$.proxy(this._onRecognitionResult,this);this._oRecognition.onend=$.proxy(this._onRecognitionEnd,this)}};return speechRecognizer});