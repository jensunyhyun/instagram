define(["jquery"],function($){function IframePopup(options){this.width=options.width||400;this.height=options.height||590;this.url=options.url||"";this.element=null}IframePopup.prototype.render=function(){this.element=$("\x3ciframe\x3e",{src:this.url,"class":"iframe-layout-popup",scrolling:"no"});this.element.appendTo($("body"))};IframePopup.prototype.open=function(){if(!this.url)throw new Error("url must be registered");this.render();this.resize()};IframePopup.prototype.postMessage=function(message){if(this.element.length>
0){var contentWindow=this.element[0].contentWindow;if(contentWindow)contentWindow.postMessage(JSON.stringify(message),"*")}};IframePopup.prototype.resize=function(){var frameHeight=this.height||$(window).height()/1.45;var frameWidth=this.width||this.element.width();this.element.height(frameHeight);this.element.width(frameWidth);this.element.css("margin-left",-frameWidth/2);if(frameHeight>480)this.element.css("margin-top",-frameHeight/2)};IframePopup.prototype.closeWithPromise=function(promiseFunc){var promise=
promiseFunc();var self=this;if(!promise.then)throw new Error("closeWithPromise must has a function parameter which returns a promise");promise.then(function(){self.close()})};IframePopup.prototype.close=function(){$(".iframe-layout-popup").remove()};IframePopup.prototype.setFullScreen=function(){this.element.css({position:"fixed",left:"50%",top:"50%",zIndex:1E3,border:0});var $html=$("html");var htmlOverflowBackup=$html.css("overflow");$html.css("overflow","hidden");var background=$("\x3cdiv\x3e",
{css:{position:"fixed",zIndex:990,left:0,top:0,width:"100%",height:"100%",background:"black",opacity:.5}});background.appendTo($("body"));return function reset(){$html.css({overflow:htmlOverflowBackup});background.detach()}};return IframePopup});