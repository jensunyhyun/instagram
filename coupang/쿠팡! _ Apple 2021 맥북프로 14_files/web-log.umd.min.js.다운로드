!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.CoupangWebLog=e()}(this,function(){"use strict";var c=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};function r(n,r){var o,i,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),"throw":e(1),"return":e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(s=i[2&t[0]?"return":t[0]?"throw":"next"])&&!(s=s.call(i,t[1])).done)return s;switch(i=0,s&&(t=[0,s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(n,a)}catch(e){t=[6,e],i=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([e,t])}}}var J="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function H(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}var t,e,n,o,i,s,a,u,p=(function(t,e){t.exports=function(){function c(t){return"function"==typeof t}var n=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},r=0,o=void 0,i=void 0,a=function(t,e){f[r]=t,f[r+1]=e,2===(r+=2)&&(i?i(m):y())},t="undefined"!=typeof window?window:undefined,e=t||{},s=e.MutationObserver||e.WebKitMutationObserver,u="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var t=setTimeout;return function(){return t(m,1)}}var f=new Array(1e3);function m(){for(var t=0;t<r;t+=2){var e=f[t],n=f[t+1];e(n),f[t]=undefined,f[t+1]=undefined}r=0}var l,g,h,v,y=void 0;function w(t,e){var n=this,r=new this.constructor(E);r[S]===undefined&&k(r);var o=n._state;if(o){var i=arguments[o-1];a(function(){return V(o,r,i,n._result)})}else C(n,r,t,e);return r}function b(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(E);return _(e,t),e}u?y=function(){return process.nextTick(m)}:s?(g=0,h=new s(m),v=document.createTextNode(""),h.observe(v,{characterData:!0}),y=function(){v.data=g=++g%2}):p?((l=new MessageChannel).port1.onmessage=m,y=function(){return l.port2.postMessage(0)}):y=t===undefined?function(){try{var t=H,e=t("vertx");return void 0!==(o=e.runOnLoop||e.runOnContext)?function(){o(m)}:d()}catch(n){return d()}}():d();var S=Math.random().toString(36).substring(16);function E(){}var T=void 0,L=1,P=2,A=new q;function R(t){try{return t.then}catch(e){return A.error=e,A}}function O(t,e,n){var r,o,i,s;e.constructor===t.constructor&&n===w&&e.constructor.resolve===b?(i=t,(s=e)._state===L?D(i,s._result):s._state===P?x(i,s._result):C(s,undefined,function(t){return _(i,t)},function(t){return x(i,t)})):n===A?(x(t,A.error),A.error=null):n===undefined?D(t,e):c(n)?(r=e,o=n,a(function(e){var n=!1,t=function(t,e,n,r){try{t.call(e,n,r)}catch(o){return o}}(o,r,function(t){n||(n=!0,r!==t?_(e,t):D(e,t))},function(t){n||(n=!0,x(e,t))},e._label);!n&&t&&(n=!0,x(e,t))},t)):D(t,e)}function _(t,e){var n,r;t===e?x(t,new TypeError("You cannot resolve a promise with itself")):(r=typeof(n=e),null===n||"object"!==r&&"function"!==r?D(t,e):O(t,e,R(e)))}function I(t){t._onerror&&t._onerror(t._result),M(t)}function D(t,e){t._state===T&&(t._result=e,t._state=L,0!==t._subscribers.length&&a(M,t))}function x(t,e){t._state===T&&(t._state=P,t._result=e,a(I,t))}function C(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+L]=n,o[i+P]=r,0===i&&t._state&&a(M,t)}function M(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,o=void 0,i=t._result,s=0;s<e.length;s+=3)r=e[s],o=e[s+n],r?V(n,r,o,i):o(i);t._subscribers.length=0}}function q(){this.error=null}var N=new q;function V(t,e,n,r){var o=c(n),i=void 0,s=void 0,a=void 0,u=void 0;if(o){if((i=function(t,e){try{return t(e)}catch(n){return N.error=n,N}}(n,r))===N?(u=!0,s=i.error,i.error=null):a=!0,e===i)return void x(e,new TypeError("A promises callback cannot return that same promise."))}else i=r,a=!0;e._state!==T||(o&&a?_(e,i):u?x(e,s):t===L?D(e,i):t===P&&x(e,i))}var j=0;function k(t){t[S]=j++,t._state=undefined,t._result=undefined,t._subscribers=[]}var F=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(E),this.promise[S]||k(this.promise),n(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?D(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&D(this.promise,this._result))):x(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===T&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===b){var o=R(e);if(o===w&&e._state!==T)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===U){var i=new n(E);O(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},t.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===T&&(this._remaining--,t===P?x(r,n):this._result[e]=n),0===this._remaining&&D(r,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;C(t,undefined,function(t){return n._settledAt(L,e,t)},function(t){return n._settledAt(P,e,t)})},t}(),U=function(){function e(t){this[S]=j++,this._result=this._state=undefined,this._subscribers=[],E!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t(function(t){_(e,t)},function(t){x(e,t)})}catch(n){x(e,n)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype["catch"]=function(t){return this.then(null,t)},e.prototype["finally"]=function(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})})},e}();return U.prototype.then=w,U.all=function(t){return new F(this,t).promise},U.race=function(o){var i=this;return n(o)?new i(function(t,e){for(var n=o.length,r=0;r<n;r++)i.resolve(o[r]).then(t,e)}):new i(function(t,e){return e(new TypeError("You must pass an array to race."))})},U.resolve=b,U.reject=function(t){var e=new this(E);return x(e,t),e},U._setScheduler=function(t){i=t},U._setAsap=function(t){a=t},U._asap=a,U.polyfill=function(){var t=void 0;if(void 0!==J)t=J;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(r){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(r){}if("[object Promise]"===n&&!e.cast)return}t.Promise=U},U.Promise=U}()}(t={exports:{}},t.exports),t.exports),d=/MSIE ([0-9]{1,}[\\.0-9]{0,})/,f=/Trident\/(\d)/i,m={isIE:function(){return-1<navigator.userAgent.toLowerCase().indexOf("msie")},isIE11:function(){return"Netscape"===navigator.appName&&-1<navigator.userAgent.search("Trident")},getVersion:function(){var t=-1;return"Microsoft Internet Explorer"===navigator.appName&&null!=d.exec(navigator.userAgent)&&(t=parseFloat(RegExp.$1)),t},hasTridentVersion:function(){return null!==navigator.userAgent.match(f)}},l={isSupported:function(){return!(m.isIE()&&m.getVersion()<=7&&!1===m.hasTridentVersion())},isSupportXMLRequest:function(){return!(m.isIE()&&m.getVersion()<=9)||this.isIE11()},isIE8:function(){return m.isIE()&&8===m.getVersion()},isIE11:m.isIE11,isLowerThanIE10:function(){return m.isIE()&&m.getVersion()<10&&!this.isIE11()}};l.isSupported()&&(p.polyfill(),Date.prototype.toISOString||function(){function t(t){return t<10?"0"+t:t}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+t(this.getUTCMonth()+1)+"-"+t(this.getUTCDate())+"T"+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())+"."+(this.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}}(),!window.addEventListener&&(e=Window.prototype,n=HTMLDocument.prototype,o=Element.prototype,s="removeEventListener",a="dispatchEvent",u=[],e[i="addEventListener"]=n[i]=o[i]=function(t,e){var n=this;u.unshift([n,t,e,function(t){t.currentTarget=n,t.preventDefault=function(){t.returnValue=!1},t.stopPropagation=function(){t.cancelBubble=!0},t.target=t.srcElement||n,e.call(n,t)}]),this.attachEvent("on"+t,u[0][3])},e[s]=n[s]=o[s]=function(t,e){for(var n=0,r=void 0;r=u[n];++n)if(r[0]==this&&r[1]==t&&r[2]==e)return this.detachEvent("on"+t,u.splice(n,1)[0][3])},e[a]=n[a]=o[a]=function(t){return this.fireEvent("on"+t.type,t)}),"function"!=typeof Object.assign&&(Object.assign=function(t){if(t===undefined||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==undefined&&null!==r)for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])}return e}),window.performance&&!window.performance.now&&(Date.now=Date.now||function(){return(new Date).getTime()},window.performance.now=function(){return Date.now()-(performance.timing&&performance.timing.navigationStart||Date.now())}));var g=l.isLowerThanIE10()?function(t,e,n,r){var o="";return o+="["+t+"/"+e+"]",{message:o+=" : "+n,color:null}}:function(t,e,n,r){var o="";return o+="%c["+t+"/"+e+"]",{message:o+=" :  "+n,color:r="color: "+r+";"}},h={isDebugEnabled:!1,setDebugMode:function(){this.isDebugEnabled=!0},d:function(t,e){if(window.console&&this.isDebugEnabled){var n=g("Debug",t,e,"purple");n.color?console.log(n.message,n.color):console.log(n.message)}},i:function(t,e){if(window.console&&this.isDebugEnabled){var n=g("Info",t,e,"green");n.color?console.info(n.message,n.color):console.info(n.message)}},w:function(t,e){if(window.console&&this.isDebugEnabled){var n=g("Warn",t,e,"orange");n.color?console.warn(n.message,n.color):console.warn(n.message)}},e:function(t,e){if(window.console&&this.isDebugEnabled){var n=g("Error",t,e,"red");n.color?console.error(n.message,n.color):console.error(n.message)}}},v="WebLogRequester",y={production:"weblog.coupang.com",integration:"weblog-test.coupang.com",develop:"weblog-test.coupang.com",internal:"weblog.coupangdev.com"},w={production:"weblog-private.coupang.net",integration:"weblog-test-private.coupang.net",develop:"weblog-test-private.coupang.net",internal:"weblog.coupangdev.com"},b="INVALID_PAYLOAD",S="INTERNAL_ERROR",E=[],T=l.isSupportXMLRequest(),L=function(){function t(t,e,n){void 0===n&&(n=!1),this.isSupportXMLRequest=T,this.serviceName=t,this.mode=e,this.usePrivateELB=n}return t.prototype.send=function(n){return e=this,u=function(){var e;return r(this,function(t){switch(t.label){case 0:h.d(v,"#send - is support 'XMLHttpRequest':"+T),t.label=1;case 1:return t.trys.push([1,6,,7]),!0!==this.isSupportXMLRequest?[3,3]:[4,this.sendXMLHttpRequest(n)];case 2:return[2,t.sent()];case 3:return[4,this.sendXDomainRequest(n)];case 4:return[2,t.sent()];case 5:return[3,7];case 6:throw e=t.sent(),h.e(v,e.message),e;case 7:return[2]}})},new((a=s=void 0)||(a=Promise))(function(t,n){function r(t){try{i(u.next(t))}catch(e){n(e)}}function o(t){try{i(u["throw"](t))}catch(e){n(e)}}function i(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(r,o)}i((u=u.apply(e,s||[])).next())});var e,s,a,u},t.prototype.sendSync=function(t){var e=new Image,n=this.getEndpoint(),r="record="+encodeURIComponent(JSON.stringify(t));e.src=n+"?"+r,h.i(v,"#sendLoggingRequest - sendSync : success")},t.prototype.isValidResponse=function(t){var e=(t.responseText?JSON.parse(t.responseText):{}).type;return!(e&&(e===S||e===b))},t.prototype.getEndpoint=function(){var t=this.usePrivateELB?w:y;return"https://"+(t[this.mode]||t.production)+"/weblog/submit/"+this.serviceName},t.prototype.sendXMLHttpRequest=function(e){var a=this;return new Promise(function(o,i){var s=new XMLHttpRequest,t=a.convertJsonToString(e);s.open("POST",a.getEndpoint(),!0),s.setRequestHeader("Content-Type","text/plain"),s.onload=function(){var t=s.readyState,e=s.status,n=s.statusText,r=s.responseText;t===XMLHttpRequest.DONE&&200===s.status&&a.isValidResponse(s)?(h.i(v,"#sendXMLHttpRequest - onload\n status: "+e+", statusText: "+n+", responseText: "+r),o({status:e,statusText:n,responseText:r})):i(new Error("#sendXMLHttpRequest - onload\n status: "+e+", statusText: "+n+", responseText: "+r))},s.onerror=function(){var t=s.status,e=s.statusText,n=s.responseText;i(new Error("#sendXMLHttpRequest - onerror\n status:"+t+", statusText: "+e+", responseText: "+n))},s.send(t),h.d(v,"#sendXMLHttpRequest - send data \n"+t)})},t.prototype.sendXDomainRequest=function(s){var a=this;return new Promise(function(e,n){var r=new XDomainRequest,t=Date.now()+50,o=a.convertJsonToString(s),i=function(){var t=E.indexOf(r);0<=t&&E.splice(t,1),r.onload=null,r.onerror=null,r.ontimeout=null,r.onprogress=null};for(r.onload=function(){var t=r.responseText;a.isValidResponse(r)?(h.i(v,"#sendXDomainRequest - onload\n responseText: "+t),e({responseText:t})):n(new Error("#sendXDomainRequest - onload\n responseText: "+t)),i()},r.onerror=function(){n(new Error("#sendXDomainRequest - onerror\n responseText: "+r.responseText)),i()},r.ontimeout=function(){i()},r.onprogress=function(){},r.open("POST",a.getEndpoint()),r.send(o),E.push(r);Date.now()<t;);h.d(v,"#sendXDomainRequest - send data \n"+o)})},t.prototype.convertJsonToString=function(t){return JSON.stringify(t||{})},t}(),P="AppLogRequester",A=function(){function t(){}return t.prototype.isApp=function(){return this.hasAndroidFunction()||this.hasIOSFunction()},t.prototype.send=function(t){var e=JSON.stringify(t);if(this.hasAndroidFunction())h.d(P,"#send - using window.CoupangAppTracking.logEvent function"),window.CoupangAppTracking.logEvent(e);else{if(!this.hasIOSFunction())return void h.w(P,"#send - Not found App Function.");h.d(P,"#send - using window.webkit.messageHandlers.callBackHandler.postMessage function"),window.webkit.messageHandlers.callBackHandler.postMessage(e)}h.i(P,"#sendToApp - jsonString \n "+e)},t.prototype.hasAndroidFunction=function(){return!(!window.CoupangAppTracking||!window.CoupangAppTracking.logEvent||"function"!=typeof window.CoupangAppTracking.logEvent)},t.prototype.hasIOSFunction=function(){return!!(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.callBackHandler&&window.webkit.messageHandlers.callBackHandler.postMessage&&"function"==typeof window.webkit.messageHandlers.callBackHandler.postMessage)},t}(),R=function(){function t(){var t=window.location.href,e=document.referrer||"";this.setPvId(this.generatePvId()),this.setRvId(""),this.setReferrer(e),this.setUrl(t)}return t.prototype.getJSON=function(){return{web:{pvid:this.pvid,rvid:this.rvid,url:this.url,referrer:this.referrer}}},t.prototype.generatePvId=function(){var t,e="";for(t=0;t<32;t++){var n=16*Math.random()|0;8!==t&&12!==t&&16!==t&&20!==t||(e+="-"),e+=(12===t?4:16===t?3&n|8:n).toString(16)}return e},t.prototype.setPvId=function(t){this.pvid=t},t.prototype.setRvId=function(t){this.rvid=t},t.prototype.setUrl=function(t){this.url=t},t.prototype.setReferrer=function(t){this.referrer=t},t}(),O=function(t){var e,n=t+"=",r=decodeURIComponent(document.cookie).split(";");for(e=0;e<r.length;e++){for(var o=r[e];" "===o.charAt(0);)o=o.substring(1);if(0===o.indexOf(n))return o.substring(n.length,o.length)}return""},_=function(t,e,n,r,o){var i,s,a=new Date(2100,1,1),u=(i=decodeURIComponent(document.domain),3!==(s=i.split(".")).length&&4!==s.length?i:i.replace(/^(?:[\w\d]+\.)?([^:/]*).*$/i,"$1")),c=[];c.push(t+"="+encodeURIComponent(e)),c.push("; expires="+(n&&n.toUTCString()||a.toUTCString())),c.push("; domain="+(r||u)),c.push(o&&"; secure"),document.cookie=c.join("")},I="1.3.3",D=function(){function t(){this.setLang().setMemberSrl().setPCID().setResolution().setLibraryVersion(I).setCommonWebParameter(new R)}return t.prototype.setPlatform=function(t){return this.platform=t,this},t.prototype.setEventTime=function(t){return this.eventTime=t,this},t.prototype.setPCID=function(){return this.pcid=O("PCID")||this.generatePCID(),this},t.prototype.setMemberSrl=function(){return this.memberSrl=O("member_srl"),this},t.prototype.setLibraryVersion=function(t){return this.libraryVersion=t,this},t.prototype.setLang=function(){return this.lang=navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage,this},t.prototype.setResolution=function(){return this.resolution=window.screen.width+"x"+window.screen.height,this},t.prototype.getJSON=function(){var t=this,e=t.platform,n=t.pcid,r=t.memberSrl,o=t.libraryVersion,i=t.lang,s=t.resolution,a=t.eventTime,u=t.commonWebParameter.getJSON();return{common:c({platform:e,pcid:n,memberSrl:r,libraryVersion:o,lang:i,resolution:s,eventTime:a},u)}},t.prototype.getLibVersion=function(){return I},t.prototype.getExtraWebviewJSON=function(t){var e=this.commonWebParameter.getJSON(),n=c({eventTime:this.eventTime,pcid:this.pcid,libraryVersion:this.getLibVersion()},e.web);if(t){var r=n.url||"",o=n.referrer||"";100<r.length&&(n.url=r.substring(0,100)+"......"),100<o.length&&(n.referrer=o.substring(0,100)+"......")}return n},t.prototype.generatePCID=function(){var t,e=new Date,n=[];return n.push(e.getTime()),n.push(Math.random().toString().substr(2)),_("PCID",t=n.join("").substr(0,23)),t},t.prototype.setCommonWebParameter=function(t){return this.commonWebParameter=t,this},t}(),x=function(){function t(){}return t.prototype.setSchemaId=function(t){return this.schemaId=t,this},t.prototype.setSchemaVersion=function(t){return this.schemaVersion=t,this},t.prototype.getJSON=function(){return{meta:{schemaId:this.schemaId,schemaVersion:this.schemaVersion}}},t}(),C=function(){function t(){this.data={}}return t.prototype.setData=function(t){return this.data=t,this},t.prototype.getJSON=function(){return{data:this.data}},t}(),M=function(){function t(){}return t.prototype.setExtraData=function(t){return this.extraData=t,this},t.prototype.setSentTime=function(t){return this.sentTime=t,this},t.prototype.getJSON=function(){var t=this.sentTime,e=this.extraData;return{extra:c({sentTime:t},e)}},t}(),q={COOKIE:{PCID:"PCID",MEMBERSRL:"member_srl",ISAPP:"ISAPP",CAMPAIGN:["trac_src","trac_spec","trac_sid","trac_lptag","trac_itime","trac_ctag","trac_appver","trac_addtag"]}},N=function(){var r={};return q.COOKIE.CAMPAIGN.map(function(t){var e=t.replace(/^trac\_/,""),n=O(t).replace(/"/g,"");r[e]="0"!==n&&n||""}),r.src&&r.spec&&{campaign:r}||{}},V="ParameterStore",j=function(){function o(){this.store={}}return o.prototype.register=function(t,e){t?void 0!==e?(this.store[t]=e,h.d(V,"#register - data \n"+JSON.stringify(e))):h.w(V,"#register - 'Data is not exist. Can not register data in "+t+"."):h.w(V,"#register - key argument is not exist.")},o.prototype.getRegisteredData=function(t){if(!t)return h.w(V,"#getRegisteredData - key argument is not exist."),null;if("undefined"==typeof this.store[t])return h.w(V,'#getRegisteredData - has not registered data by "'+t+'" key.'),null;var e=this.store[t];return h.d(V,"#getRegisteredData - registered data \n"+JSON.stringify(e)),e},o.prototype.findValueFromPath=function(t){var e,n,r;if(t){for(r=t.replace(/"/g,"").replace(o.DYNAMIC_VALUE_FLAG,"").split(o.FIELD_SEPARATOR),n=this.store[r[0]],e=1;e<r.length;e++)void 0===(n=n[r[e]])&&(n="",h.w(V,"#findValueFromPath - found undefined value "+t+" > replaced with an empty string.")),h.i(V,"#findValueFromPath - found value "+t+"/"+n);return"string"==typeof n?'"'+n+'"':"object"==typeof n?JSON.stringify(n):n}h.w(V,"#findValueFromPath - path is empty")},o.prototype.replaceDynamicString=function(t){var n=this,e=JSON.stringify(t);return e=e.replace(o.REGEXP_DYNAMIC_VALUE,function(t){var e=n.findValueFromPath(t);return h.d(V,"#replaceDynamicString - replace string "+t+" > "+e),e}),JSON.parse(e)},o.prototype.merge=function(){for(var n=this,t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r={},o=!1,i=0,s=t.length;"boolean"==typeof t[0]&&(o=t[0],i++);for(var a=function(t){for(var e in t)o&&"object"==typeof t[e]?r[e]=n.merge(!0,r[e],t[e]):r[e]=t[e]};i<s;i++){a(arguments[i])}return r},o.DYNAMIC_VALUE_FLAG="@",o.REGEXP_DYNAMIC_VALUE=/("@(\w+)(|[.]\w+)+")/g,o.FIELD_SEPARATOR=".",o}(),k="AttrDataUtil",F="data-web-log",U=F+"-event",B=F+"-param",X=function(){function t(){}return t.prototype.setEvent=function(t,e){e?(t.setAttribute(U,e),h.d(k,"#setEvent - eventType: "+e)):h.w(k,"#setEvent - eventType is empty")},t.prototype.getEvent=function(t){var e=t&&t.getAttribute&&t.getAttribute(U)||"";return h.d(k,"#getEvent - eventType"+(e?": "+e:" is empty")),e},t.prototype.setRequestParam=function(t,e){if(e)if("string"==typeof e&&0===e.indexOf(j.DYNAMIC_VALUE_FLAG))t.setAttribute(B,e),h.d(k,"#setRequestParam - jsonData: "+e);else{var n=JSON.stringify(e);t.setAttribute(B,n),h.d(k,"#setRequestParam - jsonData: "+n)}else h.w(k,"#setRequestParam - jsonData is empty")},t.prototype.getRequestParam=function(t){var e=t&&t.getAttribute&&t.getAttribute(B)||"{}";return 0===e.indexOf(j.DYNAMIC_VALUE_FLAG)?(h.d(k,"#getRequestParam resister parameter string - \n"+e),e):(h.d(k,"#getRequestParam - \n"+e),JSON.parse(e))},t}(),W=function(t,e){"complete"===document.readyState||"loading"!==document.readyState&&l.isIE8()||"DOMContentLoaded"===t&&"interactive"===document.readyState?window.setTimeout(e):window.addEventListener(t,e)},G=function(){function t(t,e){this.startTime=t,this.optionFields=e}return t.prototype.stop=function(t){this.endTime=t},t.prototype.measureLatency=function(){return Math.floor(this.endTime-this.startTime)},t.prototype.getOptionFields=function(){return this.optionFields},t}();function Y(t){return!t||t<0?0:t}var $=function(){function t(){}return t.prototype.getNetworkParameters=function(){if(!window.performance||!window.performance.timing)return{};var t=window.performance.timing;return{navigationStart:Y(t.navigationStart),redirectStart:Y(t.redirectStart),fetchStart:Y(t.fetchStart),domainLookupStart:Y(t.domainLookupStart),connectStart:Y(t.connectStart),secureConnectionStart:Y(t.secureConnectionStart),requestStart:Y(t.requestStart),responseStart:Y(t.responseStart),redirect:Y(t.redirectEnd-t.redirectStart)||Y(t.fetchStart-t.navigationStart),dns:Y(t.domainLookupEnd-t.domainLookupStart),ssl:Y(t.connectEnd-t.secureConnectionStart),connect:Y(t.connectEnd-t.connectStart),request:Y(t.responseStart-t.requestStart),response:Y(t.responseEnd-t.responseStart)}},t}(),K="data-load-time",z="TTILog",Z=function(){function t(t,e){this.ttiObjects={},this.loadedCount=0,this.asyncLogs=[],this.imageLoadingTime=0,this.latestImageLoadingTime=0,this.webLogRequester=t,this.appLogRequester=e}return t.prototype.init=function(t){var e=t.pageName,n=t.platform,r=t.platformType,o=t.screenType,i=t.extra,s=t.async,a=void 0!==s&&s,u=t.calcType,c=void 0===u?"default":u;this.commonFields={domain:"tti",logCategory:"system",logType:"performance",eventName:"tti-logger",pageName:e,platformType:r,ixid:this.generateUUID()},this.baseOption={screenType:o,extra:i,async:a},this.calcType=c||"default",this.commonParameter=(new D).setPlatform(n),this.updatePerformanceValues(a)},t.prototype.record=function(t,e){void 0===e&&(e={});var n=window.performance.now();if(this.ttiObjects.hasOwnProperty(t))return h.w(z,"Already "+t+" is recording the TTI");(e.extra||(e.extra={})).ttiRecordKey=t,e.async=!0,this.ttiObjects[t]=new G(n,e)},t.prototype.stop=function(t){var e=this;if(!this.ttiObjects.hasOwnProperty(t))return h.w(z,t+" must first record");var n=this.ttiObjects[t],r=(n.stop(window.performance.now()),delete e.ttiObjects[t],n.measureLatency());this.recordAsync(r,n.getOptionFields())},t.prototype.manualRecord=function(t){void 0===t&&(t={});var e=Math.floor(window.performance.now()),n=Object.assign({},this.baseOption,{async:!0,extra:Object.assign(t,this.baseOption.extra)});this.recordAsync(e,n)},t.prototype.logImageLoadTime=function(t){if(window.performance.getEntriesByName){var e=t.getAttribute("src").replace(/^(\/\/)/,location.protocol+"$1"),n=performance.getEntriesByName(e),r=0<n.length&&n[0]||null,o=r&&r.responseEnd||0,i=r&&r.duration||0,s=r&&r.startTime||0,a=0<o?o:s+i;0<s&&0<a&&(t.setAttribute(K+"-start",s),t.setAttribute(K+"-end",a))}t.setAttribute(K,window.performance.now())},t.prototype.recordAsync=function(t,e){this.asyncLogs.push({tti:t,optionFields:e}),this.domReady&&this.submitAsync()},t.prototype.submitAsync=function(){var e=this;this.asyncLogs.map(function(t){return e.submit(t.tti,Object.assign({serverTime:e.serverTime,domReady:e.domReady,imageLoadingTime:e.imageLoadingTime},t.optionFields))}),this.asyncLogs=[]},t.prototype.submit=function(t,e){var n=this.appLogRequester.isApp(),r=this.makeParams(t,e);n?this.appLogRequester.send(r):this.webLogRequester.send(r),h.d(z,"#submitSync - tti: "+t+", serverTime: "+e.serverTime+", domReady: "+e.domReady+", imageLoadingTime: "+e.imageLoadingTime)},t.prototype.makeParams=function(t,e){var n=c({},(new $).getNetworkParameters(),{url:location.href},e.extra,{calcType:this.calcType}),r=(new M).setExtraData(n).setSentTime((new Date).toISOString()).getJSON();return this.commonParameter.setEventTime((new Date).toISOString()),delete e.extra,c({},this.commonParameter.getJSON(),r,{meta:{schemaId:137,schemaVersion:3},data:Object.assign({tti:t},this.commonFields,e)})},t.prototype.submitSync=function(){if(!this.syncRecorded&&this.domReady){var t=this.domReady;0<this.imageCount&&(t=Math.max(this.domReady,this.latestImageLoadingTime),this.baseOption.extra=Object.assign({latestImageLoadingTime:this.latestImageLoadingTime},this.baseOption.extra)),this.syncRecorded=!0,this.submit(t,Object.assign({serverTime:this.serverTime,domReady:this.domReady,imageLoadingTime:this.imageLoadingTime},this.baseOption))}},t.prototype.getLatestImageLoadTime=function(){for(var t=document.querySelectorAll("img[data-load-time]"),e=this.imageCount=t.length,n=[],r=[],o=0;o<e;o++){var i=Number(t[o].getAttribute(K));n.push(t[o].getAttribute(K+"-start")),r.push(t[o].getAttribute(K+"-end")),this.latestImageLoadingTime=this.getActualTime(Math.max(this.latestImageLoadingTime,Math.floor(i)))}0<n.length&&0<r.length&&(this.imageLoadingTime=Math.max(0,Math.floor(Math.max.apply(Math,r)-Math.min.apply(Math,n))))},t.prototype.updatePerformanceValues=function(t){var e=this;W("load",function(){e.supportTimingApi()&&(e.serverTime=Math.max(0,window.performance.timing.responseEnd-window.performance.timing.requestStart),e.domReady=e.getActualTime(window.performance.timing.domContentLoadedEventEnd-window.performance.timing.navigationStart)),e.getLatestImageLoadTime(),!t&&e.submitSync(),0<e.asyncLogs.length&&e.submitAsync()})},t.prototype.getActualTime=function(t){return"excludeRedirect"===this.calcType&&this.supportTimingApi()&&(t-=window.performance.timing.fetchStart-window.performance.timing.navigationStart),Math.max(0,t)},t.prototype.supportTimingApi=function(){return window.performance&&window.performance.timing},t.prototype.generateUUID=function(){for(var t="",e=0;e<32;e++){var n=16*Math.random()|0;8!==e&&12!==e&&16!==e&&20!==e||(t+="-"),t+=(12===e?4:16===e?3&n|8:n).toString(16)}return t},t}(),Q="WebLog",tt="coupang-web-log",et=["click","mouseenter","mouseleave","hold","scroll","swipe","keyup","keydown"],nt={PLATFORM:"data-platform",SERVICE:"data-service",MODE:"data-mode",AUTO_SEND_PAGEVIEW_LOG:"data-auto-send-pageview",PRIVATE_ELB:"data-private-elb",TTI:"data-tti"},rt=["coupang.net","coupangdev.com"],ot=function(){function t(){var t=document.getElementById(tt);if(t&&!window.CoupangWebLog){var e={platform:t.getAttribute(nt.PLATFORM)||"",service:t.getAttribute(nt.SERVICE)||"",mode:t.getAttribute(nt.MODE)||"",useAutoSendPageViewLog:"true"===t.getAttribute(nt.AUTO_SEND_PAGEVIEW_LOG),usePrivateELB:t.getAttribute(nt.PRIVATE_ELB)||"auto",tti:JSON.parse(t.getAttribute(nt.TTI))};h.d(Q,"#constructor - use custom attribute(data-platform, data-service, data-mode, data-auto-send-pageview) for initialize"),this.init(e)}else h.d(Q,"#constructor - Not found script tag(#coupang-web-log) for initialize")}return t.prototype.init=function(t){void 0===t&&(t={platform:"web",service:"coupang",mode:"production",useAutoSendPageViewLog:!1,usePrivateELB:"auto"});var e=t.platform,n=t.service,r=t.mode,o=t.useAutoSendPageViewLog,i=t.usePrivateELB,s=t.tti;"production"!==r&&h.setDebugMode(),h.d(Q,"#init - platform: "+e+", service: "+n+", mode: "+r+", useAutoSendPageViewLog: "+o+", usePrivateELB: "+i);var a=!i||"auto"===i.toLowerCase()?this.shouldUsePrivateELB():"true"===i;if(this.serviceName=n,this.mode=r,this.webLogRequester=new L(n,r,a),this.appLogRequester=new A,this.attrDataUtil=new X,this.parameterStore=new j,this.campaignParameter=N(),this.platform=this.detectPlatform(e),o&&this.autoSendPageViewLog(),this.bindEvent(et),s&&!window.ttiSubmit){var u=new Z(this.webLogRequester,this.appLogRequester);h.d(Q,"#init - Active 'tti-logger'"),u.init(Object.assign({platform:this.platform},s)),window.ttiSubmit=u.manualRecord.bind(u),window.ttiRecord=u.record.bind(u),window.ttiStop=u.stop.bind(u),window.logImageLoadTime=u.logImageLoadTime.bind(u)}return this},t.prototype.autoSendPageViewLog=function(){var n=this,r=function(){h.d(Q,"#autoSendPageViewLog - called onLoadListener");var t=document.querySelector("[data-web-log-event=pageview]"),e=n.getRequestParam(t);n.submit(n.parameterStore.replaceDynamicString(e),!0),window.removeEventListener("load",r),h.d(Q,"#autoSendPageViewLog - removeEventListener success")};W("load",r),h.d(Q,"#autoSendPageViewLog - addEventListener success")},t.prototype.registerParameter=function(t,e){this.parameterStore.register(t,e)},t.prototype.getRegisteredParameter=function(t){return this.parameterStore.getRegisteredData(t)},t.prototype.setEvent=function(t,e){this.attrDataUtil.setEvent(t,e)},t.prototype.getEvent=function(t){return this.attrDataUtil.getEvent(t)},t.prototype.setRequestParam=function(t,e){this.attrDataUtil.setRequestParam(t,e)},t.prototype.getRequestParam=function(t){return this.attrDataUtil.getRequestParam(t)},t.prototype.submit=function(t,e){void 0===e&&(e=!1);var n=!1,r=!0;"boolean"==typeof e?n=e:null!==e&&"object"==typeof e&&(n=!!e.isPVLog,r=!!e.isAsync),n?this.submitForPV(t,r):this.submitForEvent(t,r),h.d(Q,"#submit - isPVLog: "+n+", isAsync: "+r)},t.prototype.shouldUsePrivateELB=function(){var t=document.location.protocol.toLowerCase();if("http"===t||"https"===t)for(var e=document.location.hostname||document.location.host.split(":")[0],n=0,r=rt;n<r.length;n++){var o=r[n];if(e.toLowerCase().endsWith(o))return h.d(Q,"#shouldUsePrivateELB - detected private ELB pageHost: "+e+", privateDomain: "+o),!0}return!1},t.prototype.detectPlatform=function(t){var e=t.trim().toLowerCase(),n=e;return"android"!==e&&"ios"!==e||this.appLogRequester.isApp()||(h.d(Q,"#detectPlatform - detected platform : from "+t+" => mweb"),n="mweb"),n},t.prototype.submitForPV=function(t,e){var n,r=this.appLogRequester.isApp();this.commonParameter=this.generateCommonParameter(),this.commonParameter.setEventTime((new Date).toISOString()),n=this.generateRequestJSON(t),h.d(Q,"#submitForPV - isApp: "+r),r?this.appLogRequester.send(n):e&&this.webLogRequester.send(n)||this.webLogRequester.sendSync(n)},t.prototype.submitForEvent=function(t,e){var n,r=this.appLogRequester.isApp();this.commonParameter||(h.w(Q,"#submitForEvent - this.commonParameter is not initialized (generate common parameter)"),this.commonParameter=this.generateCommonParameter()),this.commonParameter.setEventTime((new Date).toISOString()),n=this.generateRequestJSON(t),h.d(Q,"#submitForEvent - isApp: "+r),r?this.appLogRequester.send(n):e&&this.webLogRequester.send(n)||this.webLogRequester.sendSync(n)},t.prototype.generateCommonParameter=function(){return(new D).setPlatform(this.platform)},t.prototype.generateMetaParameter=function(t){var e=t.schemaId,n=t.schemaVersion;return e&&n||h.w(Q,"#generateMetaParameter - schemaId: "+e+", schemaVersion: "+n),(new x).setSchemaId(e).setSchemaVersion(n)},t.prototype.generateDataParameter=function(t){return(new C).setData(t)},t.prototype.generateExtraParameter=function(t){return(new M).setExtraData(t).setSentTime((new Date).toISOString())},t.prototype.generateRequestJSON=function(t){var e=t.meta,n=t.data,r=t.extra,o=e?this.generateMetaParameter(e).getJSON():{meta:{}},i=n?this.generateDataParameter(n).getJSON():{data:{}},s=r?this.generateExtraParameter(r).getJSON():{extra:{}},a=this.commonParameter.getJSON();return this.appLogRequester.isApp()&&(s.$webview=this.commonParameter.getExtraWebviewJSON(!0)),c({},a,o,i,s,this.campaignParameter)},t.prototype.bindEvent=function(n){var s=this,r=function(t){for(var e,n=t.type,r=t.target,o=!1;!o&&r;){if((e=s.getEvent(r))&&e===n){o=!0;break}r=r.parentNode}if(!0===o){h.d(Q,"#bindEvent - matched "+n+" eventType");var i=s.getRequestParam(r);s.submit(s.parameterStore.replaceDynamicString(i))}};W("load",function(){var t,e;for(t=0;t<n.length;t++)e=n[t],h.d(Q,"#bindEvent - addEventListener eventType: "+e),document.addEventListener(e,r,!1)})},t}();if(!l.isSupported()){var it=void 0,st=function(){};for(it in ot.prototype)"function"==typeof ot.prototype[it]&&(ot.prototype[it]=st)}return new ot});
//# sourceMappingURL=web-log.umd.min.js.map
