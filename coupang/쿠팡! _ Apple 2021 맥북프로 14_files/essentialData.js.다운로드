define(["jquery","common/utils/validationUtils"],function($,validator){var key={bundleId:"bundleid",legacyProductId:"productid",productId:"productId",documentSrl:"documentsrl",controller:"controller",resourceDomain:"resourcedomain",abTestKey:"abtestkey",login:"login",logistics:"logistics",maxPerPerson:"maxPerPerson",travelAbTestInflows:"travelAbTestInflows",isTravelAbTestTargetB:"isTravelAbTestTargetB",profile:"profile",subscribable:"subscribable",deliveryProduct:"deliveryProduct",attributeTypeId:"attributeTypeId",
useSearchApi:"useSearchApi",isPagingTarget:"isPagingTarget",pineAccessCheck:"pineAccessCheck",vendorItemPackageId:"vendorItemPackageId",cartapiUrl:"cartapiUrl",dataFodiumWebUrl:"data-fodium-web-url",vendorItemId:"vendorItemId",isRenewalRecentlyViewedProduct:"isRenewalRecentlyViewedProduct",optionBannerDisplayType:"optionBannerDisplayType",qctoken:"qctoken",collectionType:"collectionType",isTargetOfDeliveryInformation:"isTargetOfDeliveryInformation",webDomain:"webDomain",isIntra:"isIntra",itemId:"itemId",
deliveryType:"deliveryType",salePrice:"salePrice",shippingFee:"shippingFee",stockQuantity:"stockQuantity",invalidProduct:"invalidProduct",invalidUnknownProduct:"invalidUnknownProduct",trCid:"trCid",trAid:"trAid"};var sectionDataInitializer,extractor,contentsData,detailSectionData,valueHolderData,bodyData=$("body").data("reference");var state={};var watchers={};var o=$({});var $placeHolder=$(".product-contents-placeholder");var subscribe=function(){o.on.apply(o,arguments)};var unpublish=function(){o.off.apply(o,
arguments)};var publish=function(){o.trigger.apply(o,arguments)};$.each(bodyData,function(key,value){});sectionDataInitializer={setContentsDataIfDataIsEmpty:function(){if(validator.isEmpty(contentsData))contentsData=$("#contents").data("reference")},setDetailSectionDataIfDataIsEmpty:function(){if(validator.isEmpty(detailSectionData))detailSectionData=$(".detail-section").data("reference")}};(function(){$.ajax({url:"//www.coupang.com/np/client-information",success:function(data){var intraAcess=data["intraAccess"];
if(validator.isNotEmpty(intraAcess))bodyData[key.isIntra]=intraAcess}})})();extractor={showIncorrectInfoLink:function(){return $placeHolder.data("showIncorrectInfoLink")},getShippingFeeEnhance:function(){return $placeHolder.data("shippingFeeEnhance")},getScpSellerLinkStyle:function(){return $placeHolder.data("scpSellerLinkStyle")},isFromSrp:function(){return $placeHolder.data("addSrpTrack")},getClickProductId:function(){return $placeHolder.data("clickProductId")},getClickItemId:function(){return $placeHolder.data("clickItemId")},
getSdpVisitKey:function(){return $placeHolder.data("sdpVisitKey")},getIsFixedVendorItemId:function(){return $placeHolder.data("isFixedVendorItemId")},getGlobalShippingFee:function(){return $(".prod-value-holder").data("globalShippingFee")},getClickStyle:function(){return $placeHolder.data("clickStyle")},getItemRecommendStyle:function(){return $placeHolder.data("itemRecommendStyle")},refreshValueHolder:function(){valueHolderData={};var $valueHolder=$(".prod-value-holder");for(var k in key)valueHolderData[k]=
$valueHolder.data(k)},getBodyData:function(key){if(validator.isEmpty(bodyData))return"";return bodyData[key]},getSectionData:function(key){sectionDataInitializer.setContentsDataIfDataIsEmpty();if(validator.isNotEmpty(contentsData))return contentsData[key];sectionDataInitializer.setDetailSectionDataIfDataIsEmpty();if(validator.isNotEmpty(detailSectionData))return detailSectionData[key];return""},getBundleId:function(){return this.getBodyData(key.bundleId)},getController:function(){return this.getBodyData(key.controller)},
getResourceDomain:function(){return this.getBodyData(key.resourceDomain)},getLegacyProductId:function(){return this.getSectionData(key.legacyProductId)},getProductId:function(){return this.getSectionData(key.productId)},getItemId:function(){return this.getSectionData(key.itemId)},getDocumentSrl:function(){return this.getSectionData(key.documentSrl)},getAbTestKeys:function(){var keys=this.getBodyData(key.abTestKey);return validator.defaultValue(keys,[])},getAbTestOptionByKey:function(key){var abTestData=
this.getAbTestKeys(),defaultOption="",thisData;for(var idx=0,length=abTestData.length;idx<length;idx++){thisData=abTestData[idx];if(thisData["key"]===key)return thisData["option"]}return defaultOption},getAbTestKeysLoggingFormatData:function(){var abTestData=this.getAbTestKeys(),thisData=[];for(var idx=0,length=abTestData.length;idx<length;idx++)thisData.push(abTestData[idx].key+"_"+abTestData[idx].option);return thisData.join(",")},getLogin:function(){return this.getBodyData(key.login)},getLogistics:function(){return this.getSectionData(key.logistics)},
getMaxPerPerson:function(){return this.getSectionData(key.maxPerPerson)},getTravelAbTestInflows:function(){return this.getBodyData(key.travelAbTestInflows)},isTravelAbTestTargetB:function(){return this.getBodyData(key.isTravelAbTestTargetB)},isRemoveSalesCountInTravelLocalCultureCategories:function(){var controller=this.getController();return controller&&controller.indexOf("travel")>-1},getProfile:function(){return this.getBodyData(key.profile)},useSearchApi:function(){return this.getBodyData(key.useSearchApi)},
pineAccessCheck:function(){return this.getBodyData(key.pineAccessCheck)},isSubscribable:function(){return this.getSectionData(key.subscribable)},getDeliveryProduct:function(){return this.getSectionData(key.deliveryProduct)},getAttributeTypeId:function(){return this.getSectionData(key.attributeTypeId)},getVendorItemPackageId:function(){return this.getBodyData(key.vendorItemPackageId)},getCartapiUrl:function(){return this.getBodyData(key.cartapiUrl)},getDataFodiumWebUrl:function(){return this.getBodyData(key.dataFodiumWebUrl)},
getVendorItemId:function(){return this.getSectionData(key.vendorItemId)},getDdpOptionBannerDisplayType:function(){return this.getSectionData(key.optionBannerDisplayType)},isRenewalRecentlyViewedProduct:function(){return this.getBodyData(key.isRenewalRecentlyViewedProduct)==="true"},isPagingTarget:function(){return this.getBodyData(key.isPagingTarget)==="true"},getQctoken:function(){return this.getBodyData(key.qctoken)},getCollectionType:function(){return this.getBodyData(key.collectionType)},isTargetOfDeliveryInformation:function(){return this.getBodyData(key.isTargetOfDeliveryInformation)},
isIntra:function(){return this.getBodyData(key.isIntra)},getVendorItemIdFromValueHolder:function(){return valueHolderData?valueHolderData[key.vendorItemId]:this.getVendorItemId()},getLogisticsFromValueHolder:function(){return valueHolderData?valueHolderData[key.logistics]:this.getLogistics()},getSalePriceFromValueHolder:function(){return valueHolderData?valueHolderData[key.salePrice]:null},getStockQuantityFromValueHolder:function(){return valueHolderData?valueHolderData[key.stockQuantity]:null},getItemIdFromValueHolder:function(){return valueHolderData?
valueHolderData[key.itemId]:null},getTrCid:function(){return this.getBodyData(key.trCid)},getTrAid:function(){return this.getBodyData(key.trAid)},getWebDomain:function(){return this.getBodyData(key.webDomain)},setState:function(key_or_obj,value){if(arguments.length==2){state[key_or_obj]=value;if(watchers[key_or_obj])publish(key_or_obj,value)}else if(typeof key_or_obj==="object"){var obj=key_or_obj;$.extend(state,obj);for(var _key in obj)if(obj.hasOwnProperty(_key))if(watchers[key_or_obj])publish(_key,
obj[_key])}return state},getState:function(key){if(key)return state[key];else return state},watch:function(key,callback){watchers[key]=true;if(this.getState(key))callback.call(null,this.getState(key));subscribe(key,function(e,value){callback.call(null,value)})},watchOnce:function(key,callback){watchers[key]=false;if(this.getState(key))callback.call(null,this.getState(key));else subscribe(key,function(e,value){callback.call(null,value)})},_broadcast:function(){publish.apply(null,arguments)},broadcast:function(){var args=
Array.prototype.slice.call(arguments);if(!args[0])return;else{var eventList=args[0];if($.isArray(eventList))for(var i=0;i<eventList.length;i++)publish.apply(null,$.map([eventList[i],args.slice(1)],function(n){return n}));else if(typeof eventList==="string")publish.apply(null,arguments)}},watchers:function(){return watchers},isFashionStyle:function(){if($(".prod-buy").hasClass("fashion-prod-option"))return true}};return extractor});