define(["jquery","common/gnbWebLogger","common/utils/cookieUtils","common/template/urlBuilder"],function($,GnbWebLogger,cookieUtil,urlBuilder){var gnbCashWidget=function(){this.gnbCashLabelWrapper="#gnbCashLabelWrapper";this.gnbCashWidgetWrapper="#gnbCashWidgetWrapper";this.gnbCashLabelAmount="#gnbCashLabelAmount";this.gnbCashWidgetAmount="#gnbCashWidgetAmount";this.gnbCashWidgetFlag="EVT_CBW_NOTI";this.isShowCashWidget=false;this.coupayHomeUrl="https://rocketpay.coupang.com/rocketpay/mypage";this.coupangCashHomeUrl=
"https://cash.coupang.com/coupang-cash/home";GnbWebLogger.initWebLog();this.init();this.attachEvents()};gnbCashWidget.prototype={init:function(){var gnbCashWidget=$(this.gnbCashWidgetWrapper);this.updateCashContent(cookieUtil.getValue("member_srl"));if(cookieUtil.getValue(this.gnbCashWidgetFlag)!=="Y"){if($(this.gnbCashWidgetWrapper).length<=0)return;if(this.isShowCashWidget===false){cookieUtil.setCookie(this.gnbCashWidgetFlag,"Y");return}gnbCashWidget.fadeIn(500);setTimeout(function(){gnbCashWidget.fadeOut(500)},
5E3);this.impressionCashWidget();cookieUtil.setCookie(this.gnbCashWidgetFlag,"Y")}this.impressionCashLabel()},attachEvents:function(){var gnbCashLabel=$(this.gnbCashLabelWrapper);gnbCashLabel.on("mouseover",$.proxy(this.showCashWidget,this));gnbCashLabel.on("mouseleave",$.proxy(this.hideCashWidget,this));$("#gnbCashLabel").on("click",$.proxy(this.clickCashLabel,this));$("#gnbCashWidget").on("click",$.proxy(this.clickCashWidget,this))},updateCashContent:function(memberSrl){$.ajax({url:urlBuilder.buildRequestUrl("/np/cash/widget"),
type:"GET",dataType:"jsonp",jsonp:"callback",data:{memberSrl:memberSrl}}).success($.proxy(function(result){if(result!==null&&result!==""){var widgetMessage=result.message;var cashAmount=result.cashBalance;var isLoyaltyMember=result.isLoyaltyMember;var formattedCashAmount=cashAmount.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");if(widgetMessage)this.isShowCashWidget=true;else this.isShowCashWidget=false;$(this.gnbCashLabelWrapper).data("isLoyalty",isLoyaltyMember);if(cashAmount!==$(this.gnbCashLabelAmount).data("gnbCashAmount")){var gnbCashLabelAmount=
$(this.gnbCashLabelAmount);var gnbCashWidgetAmount=$(this.gnbCashWidgetAmount);gnbCashLabelAmount.text(formattedCashAmount);gnbCashWidgetAmount.text(formattedCashAmount);gnbCashLabelAmount.data("gnbCashAmount",cashAmount);gnbCashWidgetAmount.data("gnbCashAmount",cashAmount)}var gnbCashWidgetMessage=$("#gnbCashWidgetMessage");if(widgetMessage!==gnbCashWidgetMessage)gnbCashWidgetMessage.text(widgetMessage)}},this))},showCashWidget:function(){var gnbCashWidgetWrapper=$(this.gnbCashWidgetWrapper);if(gnbCashWidgetWrapper.hasClass("is-active")===
true)return;this.updateCashContent(cookieUtil.getValue("member_srl"));if(this.isShowCashWidget===false)return;gnbCashWidgetWrapper.show();gnbCashWidgetWrapper.addClass("is-active")},hideCashWidget:function(){var gnbCashWidgetWrapper=$(this.gnbCashWidgetWrapper);if(gnbCashWidgetWrapper.hasClass("is-active")===false)return;this.impressionCashWidget();gnbCashWidgetWrapper.hide();gnbCashWidgetWrapper.removeClass("is-active")},isLoyaltyMember:function(){return $(this.gnbCashLabelWrapper).data("isLoyalty")||
false},getCashAmount:function(el){return $(el).data("gnbCashAmount")||0},getCashLabelLogData:function(){var gnbCashAmount=this.getCashAmount(this.gnbCashLabelAmount),isLoyaltyMember=this.isLoyaltyMember();return'"param": { "cashAmount": '+gnbCashAmount+', "isLoyaltyMember": '+isLoyaltyMember+" }"},getCashWidgetData:function(){var gnbCashAmount=this.getCashAmount(this.gnbCashWidgetAmount),widgetMessage=$.trim($("#gnbCashWidgetMessage").text())||null,isLoyaltyMember=this.isLoyaltyMember();return'"param": { "cashAmount": '+
gnbCashAmount+', "isLoyaltyMember": '+isLoyaltyMember+', "message": "'+widgetMessage+'"}'},impressionCashLabel:function(){GnbWebLogger.impressionCustomLog('{ "id": "cash_label_impression", '+this.getCashLabelLogData()+" }")},impressionCashWidget:function(){GnbWebLogger.impressionCustomLog('{ "id": "benefit_widget_impression", '+this.getCashWidgetData()+" }")},clickCashLabel:function(){GnbWebLogger.clickCustomLog('{ "id": "cash_label", '+this.getCashLabelLogData()+"}");location.href=this.coupangCashHomeUrl},
clickCashWidget:function(){GnbWebLogger.clickCustomLog('{ "id": "benefit_widget", '+this.getCashWidgetData()+"}");location.href=this.coupangCashHomeUrl}};return gnbCashWidget});